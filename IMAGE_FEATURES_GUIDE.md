# 图片功能使用指南

## 功能概述

本项目新增了完整的图片上传和管理功能，包括：

- **用户头像**：在用户资料页面设置个人头像
- **角色头像**：为每个AI角色设置专属头像
- **聊天背景**：为每个角色的聊天界面设置背景图

## 功能特点

### 🖼️ 图片上传功能
- 支持 JPG、PNG、GIF、WebP 格式
- 自动图片压缩，优化存储空间
- 最大文件大小：5MB
- 智能尺寸调整（头像200px，背景图1200px）

### 💾 本地存储
- 所有图片保存在浏览器本地存储中
- 支持离线使用
- 自动备份和恢复
- 存储空间管理

### 🎨 智能降级
- 图片加载失败时自动显示默认图标
- 优雅的错误处理
- 保持界面美观

## 使用方法

### 1. 设置用户头像

1. 进入用户资料页面
2. 点击头像区域
3. 选择图片文件
4. 系统自动压缩并保存
5. 头像立即生效

### 2. 设置角色头像

1. 在角色选择页面点击"编辑"按钮
2. 在编辑弹窗中找到"角色头像"部分
3. 点击头像区域上传图片
4. 点击"保存"完成设置
5. 角色头像在所有界面中生效

### 3. 设置聊天背景

1. 进入聊天界面
2. 点击右上角的背景设置按钮（🖼️）
3. 在弹窗中上传背景图片
4. 背景图立即应用到当前聊天界面
5. 每个角色都有独立的背景设置

## 技术实现

### 图片服务 (`src/services/imageService.js`)

```javascript
// 主要功能
- validateFile()      // 文件验证
- compressImage()     // 图片压缩
- uploadImage()       // 图片上传
- saveImage()         // 保存到本地存储
- getImage()          // 获取图片
- deleteImage()       // 删除图片
```

### 图片上传组件 (`src/components/ImageUpload.js`)

```javascript
// 组件属性
- currentImage        // 当前图片
- onImageChange       // 图片变化回调
- type               // 图片类型 (avatar/background)
- size               // 尺寸 (small/medium/large)
- showPreview        // 是否显示预览
```

### 存储结构

```
localStorage:
├── image_user_current_user     // 当前用户头像
├── image_character_1          // 角色1头像
├── image_character_2          // 角色2头像
├── image_background_1         // 角色1背景
└── image_background_2         // 角色2背景
```

## 图片规格建议

### 用户头像
- **推荐尺寸**: 200x200px
- **格式**: JPG、PNG
- **文件大小**: < 1MB
- **建议**: 正方形图片，清晰度高

### 角色头像
- **推荐尺寸**: 200x200px
- **格式**: JPG、PNG
- **文件大小**: < 1MB
- **建议**: 符合角色特征的图片

### 聊天背景
- **推荐尺寸**: 1200x800px
- **格式**: JPG、PNG
- **文件大小**: < 3MB
- **建议**: 不干扰文字阅读的图片

## 性能优化

### 图片压缩
- 自动压缩到合适尺寸
- 保持图片质量的同时减少文件大小
- 不同用途使用不同的压缩参数

### 缓存策略
- 图片缓存在本地存储
- 避免重复上传
- 快速加载和显示

### 错误处理
- 图片加载失败时显示默认图标
- 网络错误时使用备用方案
- 优雅降级，不影响用户体验

## 存储管理

### 查看存储使用情况
```javascript
const storageInfo = imageService.getStorageInfo();
console.log(`图片数量: ${storageInfo.imageCount}`);
console.log(`总大小: ${storageInfo.totalSizeMB}MB`);
```

### 清除所有图片
```javascript
imageService.clearAllImages();
```

### 删除特定图片
```javascript
imageService.deleteImage('user_current_user');
```

## 浏览器兼容性

- ✅ Chrome 60+
- ✅ Firefox 55+
- ✅ Safari 12+
- ✅ Edge 79+
- ✅ 移动端浏览器

## 注意事项

### 隐私保护
- 所有图片仅保存在本地
- 不会上传到任何服务器
- 清除浏览器数据会删除所有图片

### 存储限制
- 浏览器本地存储通常限制为5-10MB
- 建议控制图片数量和大小
- 定期清理不需要的图片

### 性能考虑
- 大量图片可能影响页面加载速度
- 建议使用压缩后的图片
- 避免上传过大的文件

## 故障排除

### 常见问题

1. **图片上传失败**
   - 检查文件格式是否支持
   - 确认文件大小不超过5MB
   - 检查浏览器存储空间

2. **图片显示异常**
   - 刷新页面重新加载
   - 检查图片文件是否损坏
   - 清除浏览器缓存

3. **存储空间不足**
   - 删除不需要的图片
   - 使用更小的图片文件
   - 清除浏览器数据

### 错误代码

- **文件格式错误**: 只支持 JPG、PNG、GIF、WebP
- **文件过大**: 文件大小不能超过 5MB
- **存储失败**: 浏览器存储空间不足
- **加载失败**: 图片文件损坏或格式错误

## 更新日志

- v1.0.0: 基础图片上传功能
- v1.1.0: 添加图片压缩和优化
- v1.2.0: 支持多种图片类型
- v1.3.0: 添加存储管理和错误处理
- v1.4.0: 优化性能和用户体验
